select   ol_number,  sum(ol_quantity) as sum_qty,  sum(ol_amount) as sum_amount,  avg(ol_quantity) as avg_qty,  avg(ol_amount) as avg_amount,  count(*) as count_order from order_line_part2 where ol_delivery_d > '2024-10-28 17:00:00' group by ol_number order by ol_number;
select su.s_suppkey, supplier_part1.s_name, n.n_name, i.i_id, i.i_name, supplier_part1.s_address, su.s_phone, su.s_comment from item_part2 as i join stock_part2 as s on i.i_id = s.s_i_id join supplier_part2 as su on mod((s.s_w_id * s.s_i_id), 10000) = su.s_suppkey join supplier_part1 on su.s_suppkey = supplier_part1.s_suppkey join nation_part2 as n on su.s_nationkey = n.n_nationkey join nation_part1 on n.n_nationkey = nation_part1.n_nationkey join region_part2 as r on nation_part1.n_regionkey = r.r_regionkey join (select s_sub.s_i_id as m_i_id, min(s_sub.s_quantity) as m_s_quantity from stock_part2 as s_sub join supplier_part2 as su_sub on mod((s_sub.s_w_id * s_sub.s_i_id), 10000) = su_sub.s_suppkey join nation_part2 as n_sub on su_sub.s_nationkey = n_sub.n_nationkey join nation_part1 on n_sub.n_nationkey = nation_part1.n_nationkey join region_part2 as r_sub on nation_part1.n_regionkey = r_sub.r_regionkey join supplier_part2 on su_sub.s_suppkey = supplier_part2.s_suppkey where r_sub.r_name like 'europ%' group by s_sub.s_i_id) as m on i.i_id = m.m_i_id and s.s_quantity = m.m_s_quantity where i.i_data like '%b' and r.r_name like 'europ%' order by n.n_name, supplier_part1.s_name, i.i_id;
SELECT ol_o_id, ol_w_id, ol_d_id, SUM(ol_amount) AS revenue, orders_part2.o_entry_d FROM customer_part2 JOIN orders_part1 ON customer_part2.c_id = orders_part1.o_c_id AND customer_part2.c_w_id = orders_part1.o_w_id AND customer_part2.c_d_id = orders_part1.o_d_id JOIN orders_part2 ON orders_part2.o_id = orders_part1.o_id AND orders_part2.o_d_id = orders_part1.o_d_id AND orders_part2.o_w_id = orders_part1.o_w_id JOIN new_order_part2 ON new_order_part2.no_w_id = orders_part2.o_w_id AND new_order_part2.no_d_id = orders_part2.o_d_id AND new_order_part2.no_o_id = orders_part2.o_id JOIN order_line_part2 ON order_line_part2.ol_w_id = orders_part2.o_w_id AND order_line_part2.ol_d_id = orders_part2.o_d_id AND order_line_part2.ol_o_id = orders_part2.o_id WHERE customer_part2.c_state LIKE 'a%' AND orders_part2.o_entry_d > '2024-10-28 17:00:00' GROUP BY ol_o_id, ol_w_id, ol_d_id, orders_part2.o_entry_d ORDER BY revenue DESC, orders_part2.o_entry_d;
select o.o_ol_cnt, count(*) as order_count from orders_part2 o join order_line_part2 ol on o.o_id = ol.ol_o_id and o.o_w_id = ol.ol_w_id and o.o_d_id = ol.ol_d_id and ol.ol_delivery_d >= o.o_entry_d where o.o_entry_d >= '2024-10-28 17:00:00' and o.o_entry_d < '2025-10-23 17:00:00' group by o.o_ol_cnt order by o.o_ol_cnt;
SELECT nation_part2.n_name, SUM(order_line_part2.ol_amount) AS revenue FROM customer_part2 JOIN orders_part1 ON customer_part2.c_id = orders_part1.o_c_id AND customer_part2.c_w_id = orders_part1.o_w_id AND customer_part2.c_d_id = orders_part1.o_d_id JOIN orders_part2 ON orders_part2.o_id = orders_part1.o_id AND orders_part2.o_d_id = orders_part1.o_d_id AND orders_part2.o_w_id = orders_part1.o_w_id JOIN order_line_part1 ON orders_part2.o_id = order_line_part1.ol_o_id AND orders_part2.o_d_id = order_line_part1.ol_d_id AND orders_part2.o_w_id = order_line_part1.ol_w_id JOIN order_line_part2 ON order_line_part1.ol_o_id = order_line_part2.ol_o_id AND order_line_part1.ol_d_id = order_line_part2.ol_d_id AND order_line_part1.ol_w_id = order_line_part2.ol_w_id AND order_line_part1.ol_number = order_line_part2.ol_number JOIN stock_part2 ON order_line_part2.ol_w_id = stock_part2.s_w_id AND order_line_part1.ol_i_id = stock_part2.s_i_id JOIN supplier_part2 ON MOD((stock_part2.s_w_id * stock_part2.s_i_id), 10000) = supplier_part2.s_suppkey AND ASCII(SUBSTR(customer_part2.c_state, 1, 1)) = supplier_part2.s_nationkey JOIN nation_part1 ON supplier_part2.s_nationkey = nation_part1.n_nationkey JOIN nation_part2 ON nation_part1.n_nationkey = nation_part2.n_nationkey JOIN region_part2 ON nation_part1.n_regionkey = region_part2.r_regionkey WHERE region_part2.r_name = 'europe' AND orders_part2.o_entry_d >= '2024-10-28 17:00:00' GROUP BY nation_part2.n_name ORDER BY revenue DESC;
select sum(ol_amount) as revenue from order_line_part2 where ol_delivery_d >= '2024-10-23 17:00:00' and ol_delivery_d < '2024-10-28 17:00:00' and ol_quantity between 1 and 100000;
SELECT s.s_nationkey AS supp_nation, SUBSTR(c.c_state, 1, 1) AS cust_nation, EXTRACT(YEAR FROM o.o_entry_d) AS l_year, SUM(ol.ol_amount) AS revenue FROM order_line_part2 AS ol JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN stock_part2 st ON order_line_part1.ol_i_id = st.s_i_id AND ol.ol_supply_w_id = st.s_w_id JOIN orders_part2 o ON ol.ol_w_id = o.o_w_id AND ol.ol_d_id = o.o_d_id AND ol.ol_o_id = o.o_id JOIN orders_part1 ON o.o_id = orders_part1.o_id AND o.o_d_id = orders_part1.o_d_id AND o.o_w_id = orders_part1.o_w_id JOIN customer_part2 c ON orders_part1.o_c_id = c.c_id AND o.o_w_id = c.c_w_id AND o.o_d_id = c.c_d_id JOIN supplier_part2 s ON MOD((st.s_w_id * st.s_i_id), 10000) = s.s_suppkey JOIN nation_part2 n1 ON s.s_nationkey = n1.n_nationkey JOIN nation_part2 n2 ON ASCII(SUBSTR(c.c_state, 1, 1)) = n2.n_nationkey WHERE MOD((st.s_w_id * st.s_i_id), 10000) = s.s_suppkey AND ((n1.n_name = 'germany' AND n2.n_name = 'canada') OR (n1.n_name = 'canada' AND n2.n_name = 'germany')) AND o.o_entry_d BETWEEN '2024-10-28 17:00:00' AND '2025-10-23 17:00:00' GROUP BY s.s_nationkey, SUBSTR(c.c_state, 1, 1), EXTRACT(YEAR FROM o.o_entry_d) ORDER BY s.s_nationkey, cust_nation, l_year;
SELECT EXTRACT(YEAR FROM orders_part2.o_entry_d) AS l_year, SUM(CASE WHEN n2.n_name = 'germany' THEN order_line_part2.ol_amount ELSE 0 END) / SUM(order_line_part2.ol_amount) AS mkt_share FROM item_part2 JOIN stock_part2 ON item_part2.i_id = stock_part2.s_i_id JOIN supplier_part2 ON MOD((stock_part2.s_w_id * stock_part2.s_i_id), 10000) = supplier_part2.s_suppkey JOIN order_line_part1 ON stock_part2.s_i_id = order_line_part1.ol_i_id JOIN order_line_part2 ON order_line_part2.ol_o_id = order_line_part1.ol_o_id AND order_line_part2.ol_d_id = order_line_part1.ol_d_id AND order_line_part2.ol_w_id = order_line_part1.ol_w_id AND order_line_part2.ol_number = order_line_part1.ol_number JOIN orders_part1 ON order_line_part2.ol_o_id = orders_part1.o_id AND order_line_part2.ol_d_id = orders_part1.o_d_id AND order_line_part2.ol_w_id = orders_part1.o_w_id JOIN orders_part2 ON orders_part2.o_id = orders_part1.o_id AND orders_part2.o_d_id = orders_part1.o_d_id AND orders_part2.o_w_id = orders_part1.o_w_id JOIN customer_part2 ON customer_part2.c_id = orders_part1.o_c_id AND customer_part2.c_w_id = orders_part2.o_w_id AND customer_part2.c_d_id = orders_part2.o_d_id JOIN nation_part2 n1 ON n1.n_nationkey = ASCII(SUBSTR(customer_part2.c_state, 1, 1)) JOIN nation_part1 ON n1.n_nationkey = nation_part1.n_nationkey JOIN region_part2 ON nation_part1.n_regionkey = region_part2.r_regionkey JOIN nation_part2 n2 ON supplier_part2.s_nationkey = n2.n_nationkey WHERE order_line_part1.ol_i_id < 1000 AND region_part2.r_name = 'europe' AND orders_part2.o_entry_d BETWEEN '2024-10-23 17:00:00' AND '2024-10-28 17:00:00' AND item_part2.i_data LIKE '%b' AND item_part2.i_id = order_line_part1.ol_i_id GROUP BY EXTRACT(YEAR FROM orders_part2.o_entry_d) ORDER BY l_year;
SELECT n_name, EXTRACT(YEAR FROM o_entry_d) AS l_year, SUM(order_line_part2.ol_amount) AS sum_profit FROM item_part2 JOIN stock_part2 ON item_part2.i_id = stock_part2.s_i_id JOIN supplier_part2 ON MOD((stock_part2.s_w_id * stock_part2.s_i_id), 10000) = supplier_part2.s_suppkey JOIN order_line_part1 ON stock_part2.s_i_id = order_line_part1.ol_i_id JOIN order_line_part2 ON order_line_part2.ol_o_id = order_line_part1.ol_o_id AND order_line_part2.ol_d_id = order_line_part1.ol_d_id AND order_line_part2.ol_w_id = order_line_part1.ol_w_id AND order_line_part2.ol_number = order_line_part1.ol_number JOIN orders_part2 ON order_line_part2.ol_o_id = orders_part2.o_id AND order_line_part2.ol_d_id = orders_part2.o_d_id AND order_line_part2.ol_w_id = orders_part2.o_w_id JOIN nation_part2 ON supplier_part2.s_nationkey = nation_part2.n_nationkey WHERE item_part2.i_data LIKE '%bb' GROUP BY n_name, EXTRACT(YEAR FROM o_entry_d) ORDER BY n_name, l_year DESC;
SELECT customer_part2.c_id, customer_part2.c_last, SUM(ol_amount) AS revenue, customer_part2.c_city, customer_part1.c_phone, n_name FROM customer_part1 JOIN customer_part2 ON customer_part2.c_id = customer_part1.c_id AND customer_part2.c_d_id = customer_part1.c_d_id AND customer_part2.c_w_id = customer_part1.c_w_id JOIN orders_part1 ON customer_part2.c_id = orders_part1.o_c_id AND customer_part2.c_w_id = orders_part1.o_w_id AND customer_part2.c_d_id = orders_part1.o_d_id JOIN orders_part2 ON orders_part2.o_id = orders_part1.o_id AND orders_part2.o_d_id = orders_part1.o_d_id AND orders_part2.o_w_id = orders_part1.o_w_id JOIN order_line_part2 ON order_line_part2.ol_w_id = orders_part2.o_w_id AND order_line_part2.ol_d_id = orders_part2.o_d_id AND order_line_part2.ol_o_id = orders_part2.o_id JOIN nation_part2 ON nation_part2.n_nationkey = ASCII(SUBSTR(customer_part2.c_state, 1, 1)) WHERE orders_part2.o_entry_d >= '2024-10-28 17:00:00' AND orders_part2.o_entry_d <= ol_delivery_d GROUP BY customer_part2.c_id, customer_part2.c_last, customer_part2.c_city, customer_part1.c_phone, n_name ORDER BY revenue DESC;
select	 s_i_id, sum(s_order_cnt) as ordercount from	 stock_part1, supplier_part2, nation_part2 where	 mod((s_w_id * s_i_id),10000) = s_suppkey and s_nationkey = n_nationkey and n_name = 'germany' group by s_i_id having   sum(s_order_cnt) >(select sum(s_order_cnt) * 0.005 from stock_part1, supplier_part2, nation_part2 where mod((s_w_id * s_i_id),10000) = s_suppkey and s_nationkey = n_nationkey and n_name = 'germany') order by ordercount desc;
select	 o_ol_cnt, sum(case when o_carrier_id = 1 or o_carrier_id = 2 then 1 else 0 end) as high_line_count, sum(case when o_carrier_id <> 1 and o_carrier_id <> 2 then 1 else 0 end) as low_line_count from	 orders_part2, order_line_part2 where	 ol_w_id = o_w_id and ol_d_id = o_d_id and ol_o_id = o_id and o_entry_d <= ol_delivery_d and ol_delivery_d < '2025-10-23 17:00:00' group by o_ol_cnt order by o_ol_cnt;
SELECT c_count, COUNT(*) AS custdist FROM (SELECT c.c_id, COUNT(o.o_id) AS c_count FROM customer_part2 c JOIN orders_part1 ON c.c_id = orders_part1.o_c_id AND c.c_w_id = orders_part1.o_w_id AND c.c_d_id = orders_part1.o_d_id LEFT JOIN orders_part2 o ON orders_part1.o_id = o.o_id AND orders_part1.o_d_id = o.o_d_id AND orders_part1.o_w_id = o.o_w_id AND o.o_carrier_id > 8 GROUP BY c.c_id) AS c_orders GROUP BY c_count ORDER BY custdist DESC, c_count DESC;
SELECT 100.00 * SUM(CASE WHEN i.i_data LIKE 'pr%' THEN ol.ol_amount ELSE 0 END) / NULLIF(SUM(ol.ol_amount), 0) AS promo_revenue FROM order_line_part2 ol JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN item_part2 i ON order_line_part1.ol_i_id = i.i_id WHERE ol.ol_delivery_d >= '2024-10-28 17:00:00' AND ol.ol_delivery_d < '2025-10-23 17:00:00';
WITH revenue AS (SELECT MOD((st.s_w_id * st.s_i_id), 10000) AS supplier_no, SUM(ol.ol_amount) AS total_revenue FROM order_line_part2 ol JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN stock_part2 st ON order_line_part1.ol_i_id = st.s_i_id AND ol.ol_supply_w_id = st.s_w_id JOIN supplier_part2 s ON s.s_suppkey = MOD((st.s_w_id * st.s_i_id), 10000) WHERE ol.ol_delivery_d >= '2024-10-28 17:00:00' GROUP BY MOD((st.s_w_id * st.s_i_id), 10000)) SELECT s.s_suppkey, supplier_part1.s_name, supplier_part1.s_address, s.s_phone, r.total_revenue FROM supplier_part1 JOIN supplier_part2 s ON supplier_part1.s_suppkey = s.s_suppkey JOIN revenue r ON s.s_suppkey = r.supplier_no WHERE r.total_revenue = (SELECT MAX(total_revenue) FROM revenue) ORDER BY s.s_suppkey;
select i.i_name,substr(i.i_data, 1, 3) as brand,i.i_price,count(distinct mod((st.s_w_id * st.s_i_id), 10000)) as supplier_cnt from stock_part2 st join item_part2 i on i.i_id = st.s_i_id where i.i_data not like 'zz%' and mod((st.s_w_id * st.s_i_id), 10000) not in (select s.s_suppkey from supplier_part2 s where s.s_comment like '%bad%') group by i.i_name, substr(i.i_data, 1, 3), i.i_price order by supplier_cnt desc;
SELECT SUM(ol.ol_amount) / 2.0 AS avg_yearly FROM order_line_part2 ol JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN (SELECT i.i_id, AVG(ol.ol_quantity) AS a FROM order_line_part2 ol JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN item_part1 i ON order_line_part1.ol_i_id = i.i_id GROUP BY i.i_id) AS t ON order_line_part1.ol_i_id = t.i_id WHERE ol.ol_quantity < t.a;
SELECT c_last, c_id, orders_part2.o_id, orders_part2.o_entry_d, orders_part2.o_ol_cnt, SUM(ol_amount) FROM customer_part2 JOIN orders_part1 ON customer_part2.c_id = orders_part1.o_c_id AND customer_part2.c_w_id = orders_part1.o_w_id AND customer_part2.c_d_id = orders_part1.o_d_id JOIN orders_part2 ON orders_part2.o_id = orders_part1.o_id AND orders_part2.o_d_id = orders_part1.o_d_id AND orders_part2.o_w_id = orders_part1.o_w_id JOIN order_line_part2 ON order_line_part2.ol_w_id = orders_part2.o_w_id AND order_line_part2.ol_d_id = orders_part2.o_d_id AND order_line_part2.ol_o_id = orders_part2.o_id GROUP BY orders_part2.o_id, orders_part2.o_w_id, orders_part2.o_d_id, c_id, c_last, orders_part2.o_entry_d, orders_part2.o_ol_cnt HAVING SUM(ol_amount) > 200 ORDER BY SUM(ol_amount) DESC, orders_part2.o_entry_d;
SELECT SUM(ol.ol_amount) AS revenue FROM order_line_part2 ol JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN item_part2 i ON order_line_part1.ol_i_id = i.i_id WHERE ol.ol_quantity >= 1 AND ol.ol_quantity <= 10 AND i.i_price BETWEEN 1 AND 400000 AND ((i.i_data LIKE '%a' AND ol.ol_w_id IN (1, 2, 3)) OR (i.i_data LIKE '%b' AND ol.ol_w_id IN (1, 2, 4)) OR (i.i_data LIKE '%c' AND ol.ol_w_id IN (1, 5, 3)));
SELECT supplier_part1.s_name, supplier_part1.s_address FROM supplier_part1 JOIN supplier_part2 ON supplier_part1.s_suppkey = supplier_part2.s_suppkey JOIN nation_part2 ON supplier_part2.s_nationkey = nation_part2.n_nationkey JOIN order_line_part2 ol ON 1=1 JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number WHERE supplier_part2.s_suppkey IN (SELECT MOD(s.s_i_id * s.s_w_id, 10000) FROM stock_part2 s JOIN order_line_part2 ol ON s.s_i_id = order_line_part1.ol_i_id JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN item_part2 i ON s.s_i_id = i.i_id WHERE i.i_data LIKE 'co%' AND ol.ol_delivery_d > '2024-10-28 17:00:00' GROUP BY s.s_i_id, s.s_w_id, s.s_quantity HAVING 2 * s.s_quantity > SUM(ol.ol_quantity)) AND nation_part2.n_name = 'germany' ORDER BY supplier_part1.s_name;
SELECT supplier_part1.s_name, COUNT(*) AS numwait FROM supplier_part1 JOIN stock_part2 st ON supplier_part1.s_suppkey = MOD((st.s_w_id * st.s_i_id), 10000) JOIN order_line_part2 l1 ON l1.ol_w_id = st.s_w_id JOIN order_line_part1 ON l1.ol_o_id = order_line_part1.ol_o_id AND l1.ol_d_id = order_line_part1.ol_d_id AND l1.ol_w_id = order_line_part1.ol_w_id AND l1.ol_number = order_line_part1.ol_number JOIN item_part2 i ON order_line_part1.ol_i_id = i.i_id JOIN stock_part2 st2 ON i.i_id = st2.s_i_id AND l1.ol_w_id = st2.s_w_id JOIN orders_part2 o ON l1.ol_o_id = o.o_id JOIN supplier_part2 ON supplier_part1.s_suppkey = supplier_part2.s_suppkey JOIN nation_part2 n ON supplier_part2.s_nationkey = n.n_nationkey WHERE l1.ol_delivery_d > o.o_entry_d AND NOT EXISTS (SELECT * FROM order_line_part2 l2 WHERE l2.ol_o_id = l1.ol_o_id AND l2.ol_w_id = l1.ol_w_id AND l2.ol_d_id = l1.ol_d_id AND l2.ol_delivery_d > l1.ol_delivery_d) AND n.n_name = 'germany' GROUP BY supplier_part1.s_name ORDER BY numwait DESC, supplier_part1.s_name;
SELECT supplier_part1.s_name, supplier_part1.s_address FROM supplier_part1 JOIN supplier_part2 ON supplier_part1.s_suppkey = supplier_part2.s_suppkey JOIN nation_part2 ON supplier_part2.s_nationkey = nation_part2.n_nationkey JOIN order_line_part2 ol ON 1=1 JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number WHERE supplier_part2.s_suppkey IN (SELECT MOD(s.s_i_id * s.s_w_id, 10000) FROM stock_part2 s JOIN order_line_part2 ol ON s.s_i_id = order_line_part1.ol_i_id JOIN order_line_part1 ON ol.ol_o_id = order_line_part1.ol_o_id AND ol.ol_d_id = order_line_part1.ol_d_id AND ol.ol_w_id = order_line_part1.ol_w_id AND ol.ol_number = order_line_part1.ol_number JOIN item_part2 i ON s.s_i_id = i.i_id WHERE i.i_data LIKE 'co%' AND ol.ol_delivery_d > '2024-10-28 17:00:00' GROUP BY s.s_i_id, s.s_w_id, s.s_quantity HAVING 2 * s.s_quantity > SUM(ol.ol_quantity)) AND nation_part2.n_name = 'germany' ORDER BY supplier_part1.s_name;
-- select substr(c.c_state, 1, 1) as country,count(*) as numcust, sum(customer_part1.c_balance) as totacctbal from customer_part2 c  join customer_part1 on c.c_id = customer_part1.c_id and c.c_d_id = customer_part1.c_d_id and c.c_w_id = customer_part1.c_w_id where substr(customer_part1.c_phone, 1, 1) in ('1', '2', '3', '4', '5', '6', '7') and customer_part1.c_balance > (select avg(customer_part1.c_balance) from customer_part2 c2 where customer_part1.c_balance > 0.00 and substr(customer_part1.c_phone, 1, 1) in ('1', '2', '3', '4', '5', '6', '7'))and not exists (select * from orders_part1 o where o.o_c_id = c.c_id and o.o_w_id = c.c_w_id and o.o_d_id = c.c_d_id) group by substr(c.c_state, 1, 1) order by substr(c.c_state, 1, 1);
